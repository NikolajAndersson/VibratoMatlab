<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="33,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">classdef</span> Vibrato &lt; handle</span></span>
<span class="srcline"><span class="lineno"><a href="33,2" id="srcline2">  2</a></span><span class="line">    <span class="keyword">properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,3" id="srcline3">  3</a></span><span class="line">        rate</span></span>
<span class="srcline"><span class="lineno"><a href="33,4" id="srcline4">  4</a></span><span class="line">        width</span></span>
<span class="srcline"><span class="lineno"><a href="33,5" id="srcline5">  5</a></span><span class="line">        waveform</span></span>
<span class="srcline"><span class="lineno"><a href="33,6" id="srcline6">  6</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,7" id="srcline7">  7</a></span><span class="line">    <span class="keyword">properties</span> (Access=private)</span></span>
<span class="srcline"><span class="lineno"><a href="33,8" id="srcline8">  8</a></span><span class="line">        delay</span></span>
<span class="srcline"><span class="lineno"><a href="33,9" id="srcline9">  9</a></span><span class="line">        fs</span></span>
<span class="srcline"><span class="lineno"><a href="33,10" id="srcline10"> 10</a></span><span class="line">        Buffer = zeros(192001,2);</span></span>
<span class="srcline"><span class="lineno"><a href="33,11" id="srcline11"> 11</a></span><span class="line">        BufferIndex = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="33,12" id="srcline12"> 12</a></span><span class="line">        phase = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="33,13" id="srcline13"> 13</a></span><span class="line">        freq</span></span>
<span class="srcline"><span class="lineno"><a href="33,14" id="srcline14"> 14</a></span><span class="line">        amplitude = 0.9;</span></span>
<span class="srcline"><span class="lineno"><a href="33,15" id="srcline15"> 15</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,16" id="srcline16"> 16</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="33,17" id="srcline17"> 17</a></span><span class="line">    <span class="keyword">methods</span></span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="33,18" id="srcline18"> 18</a></span><span class="line">        <span class="keyword">function</span> <span class="var type1" id="S15T47U42">obj</span> = Vibrato(<span class="var type1" id="S16T3U45">r_</span>, <span class="var type1" id="S17T3U46">w_</span>, <span class="var type1" id="S18T9U47">waveform</span>, <span class="var type1" id="S19T3U48">fs_</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="33,19" id="srcline19"> 19</a></span><span class="line">            <span class="mxinfo " id="T3:U6"><span class="mxinfo " id="T3:U7"><span class="var type1" id="S15T47U52">obj</span>.rate</span> = <span class="var type1" id="S16T3U54">r_</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="33,20" id="srcline20"> 20</a></span><span class="line">            <span class="mxinfo " id="T3:U10"><span class="mxinfo " id="T3:U11"><span class="var type1" id="S15T47U58">obj</span>.width</span> = <span class="var type1" id="S17T3U60">w_</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="33,21" id="srcline21"> 21</a></span><span class="line">            <span class="mxinfo " id="T3:U14"><span class="mxinfo " id="T3:U15"><span class="var type1" id="S15T47U64">obj</span>.fs</span> = <span class="var type1" id="S19T3U66">fs_</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="33,22" id="srcline22"> 22</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="33,23" id="srcline23"> 23</a></span><span class="line">            <span class="mxinfo " id="T3:U18"><span class="mxinfo " id="T3:U19"><span class="var type1" id="S15T47U70">obj</span>.delay</span> = <span class="mxinfo " id="T3:U21">round(<span class="mxinfo " id="T3:U22"><span class="mxinfo " id="T3:U23"><span class="var type1" id="S15T47U76">obj</span>.width</span> * <span class="mxinfo " id="T3:U25"><span class="var type1" id="S15T47U79">obj</span>.fs</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="33,24" id="srcline24"> 24</a></span><span class="line">            <span class="mxinfo " id="T3:U27"><span class="mxinfo " id="T3:U28"><span class="var type1" id="S15T47U84">obj</span>.freq</span> = <span class="mxinfo " id="T3:U30"><span class="mxinfo " id="T3:U31"><span class="var type1" id="S15T47U88">obj</span>.rate</span> / <span class="mxinfo " id="T3:U33"><span class="var type1" id="S15T47U91">obj</span>.fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="33,25" id="srcline25"> 25</a></span><span class="line">            <span class="mxinfo " id="T9:U35"><span class="mxinfo " id="T9:U36"><span class="var type1" id="S15T47U96">obj</span>.waveform</span> = <span class="var type1" id="S18T9U98">waveform</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="33,26" id="srcline26"> 26</a></span><span class="line">        <span class="keyword">end</span></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="33,27" id="srcline27"> 27</a></span><span class="line">        <span class="keyword">function</span> setRate(obj,rate)</span></span>
<span class="srcline"><span class="lineno"><a href="33,28" id="srcline28"> 28</a></span><span class="line">            obj.rate = rate;</span></span>
<span class="srcline"><span class="lineno"><a href="33,29" id="srcline29"> 29</a></span><span class="line">            obj.freq = rate / obj.fs;</span></span>
<span class="srcline"><span class="lineno"><a href="33,30" id="srcline30"> 30</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,31" id="srcline31"> 31</a></span><span class="line">        <span class="keyword">function</span> setWidth(obj,width)</span></span>
<span class="srcline"><span class="lineno"><a href="33,32" id="srcline32"> 32</a></span><span class="line">            obj.width = width;</span></span>
<span class="srcline"><span class="lineno"><a href="33,33" id="srcline33"> 33</a></span><span class="line">            obj.delay = round(width * obj.fs);</span></span>
<span class="srcline"><span class="lineno"><a href="33,34" id="srcline34"> 34</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,35" id="srcline35"> 35</a></span><span class="line">        <span class="keyword">function</span> setWaveform(obj,waveform)</span></span>
<span class="srcline"><span class="lineno"><a href="33,36" id="srcline36"> 36</a></span><span class="line">            obj.waveform = waveform;</span></span>
<span class="srcline"><span class="lineno"><a href="33,37" id="srcline37"> 37</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,38" id="srcline38"> 38</a></span><span class="line">        <span class="keyword">function</span> out = process(obj, x)</span></span>
<span class="srcline"><span class="lineno"><a href="33,39" id="srcline39"> 39</a></span><span class="line">            y = zeros(size(x));</span></span>
<span class="srcline"><span class="lineno"><a href="33,40" id="srcline40"> 40</a></span><span class="line">            writeIndex = obj.BufferIndex;</span></span>
<span class="srcline"><span class="lineno"><a href="33,41" id="srcline41"> 41</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="33,42" id="srcline42"> 42</a></span><span class="line">            delta = obj.freq * 2 * pi;</span></span>
<span class="srcline"><span class="lineno"><a href="33,43" id="srcline43"> 43</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="33,44" id="srcline44"> 44</a></span><span class="line">            <span class="keyword">for</span> i = 1:size(x,1)</span></span>
<span class="srcline"><span class="lineno"><a href="33,45" id="srcline45"> 45</a></span><span class="line">                obj.Buffer(writeIndex,:) = x(i,:); <span class="comment">% Store buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,46" id="srcline46"> 46</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,47" id="srcline47"> 47</a></span><span class="line">                osc = sin(obj.phase);</span></span>
<span class="srcline"><span class="lineno"><a href="33,48" id="srcline48"> 48</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,49" id="srcline49"> 49</a></span><span class="line">                <span class="keyword">switch</span>(obj.waveform)</span></span>
<span class="srcline"><span class="lineno"><a href="33,50" id="srcline50"> 50</a></span><span class="line">                    <span class="keyword">case</span> <span class="string">'Sine'</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,51" id="srcline51"> 51</a></span><span class="line">                        osc = obj.amplitude*sin(obj.phase);</span></span>
<span class="srcline"><span class="lineno"><a href="33,52" id="srcline52"> 52</a></span><span class="line">                    <span class="keyword">case</span> <span class="string">'Square'</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,53" id="srcline53"> 53</a></span><span class="line">                        <span class="keyword">if</span> obj.phase &lt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="33,54" id="srcline54"> 54</a></span><span class="line">                            osc = obj.amplitude;</span></span>
<span class="srcline"><span class="lineno"><a href="33,55" id="srcline55"> 55</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,56" id="srcline56"> 56</a></span><span class="line">                            osc = -obj.amplitude;</span></span>
<span class="srcline"><span class="lineno"><a href="33,57" id="srcline57"> 57</a></span><span class="line">                        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,58" id="srcline58"> 58</a></span><span class="line">                    <span class="keyword">case</span> <span class="string">'Sawtooth'</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,59" id="srcline59"> 59</a></span><span class="line">                        osc = obj.amplitude - (obj.amplitude / pi * obj.phase);</span></span>
<span class="srcline"><span class="lineno"><a href="33,60" id="srcline60"> 60</a></span><span class="line">                    <span class="keyword">case</span> <span class="string">'Triangle'</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,61" id="srcline61"> 61</a></span><span class="line">                        <span class="keyword">if</span> obj.phase &lt; pi</span></span>
<span class="srcline"><span class="lineno"><a href="33,62" id="srcline62"> 62</a></span><span class="line">                            osc = -obj.amplitude + (2 * obj.amplitude / pi)  * obj.phase;</span></span>
<span class="srcline"><span class="lineno"><a href="33,63" id="srcline63"> 63</a></span><span class="line">                        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,64" id="srcline64"> 64</a></span><span class="line">                            osc = 3 * obj.amplitude - (2 * obj.amplitude / pi)  * obj.phase;</span></span>
<span class="srcline"><span class="lineno"><a href="33,65" id="srcline65"> 65</a></span><span class="line">                        <span class="keyword">end</span>                      </span></span>
<span class="srcline"><span class="lineno"><a href="33,66" id="srcline66"> 66</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,67" id="srcline67"> 67</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,68" id="srcline68"> 68</a></span><span class="line">                obj.phase = obj.phase + delta;</span></span>
<span class="srcline"><span class="lineno"><a href="33,69" id="srcline69"> 69</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,70" id="srcline70"> 70</a></span><span class="line">                <span class="keyword">if</span> obj.phase &gt; 2 * pi</span></span>
<span class="srcline"><span class="lineno"><a href="33,71" id="srcline71"> 71</a></span><span class="line">                    obj.phase = obj.phase - 2*pi;</span></span>
<span class="srcline"><span class="lineno"><a href="33,72" id="srcline72"> 72</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,73" id="srcline73"> 73</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,74" id="srcline74"> 74</a></span><span class="line">                tap = 1 + obj.delay + obj.delay * osc;</span></span>
<span class="srcline"><span class="lineno"><a href="33,75" id="srcline75"> 75</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,76" id="srcline76"> 76</a></span><span class="line">                n=floor(tap);</span></span>
<span class="srcline"><span class="lineno"><a href="33,77" id="srcline77"> 77</a></span><span class="line">                frac = tap - n;</span></span>
<span class="srcline"><span class="lineno"><a href="33,78" id="srcline78"> 78</a></span><span class="line">                readIndex = floor(writeIndex - n);</span></span>
<span class="srcline"><span class="lineno"><a href="33,79" id="srcline79"> 79</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="33,80" id="srcline80"> 80</a></span><span class="line">                <span class="keyword">if</span> readIndex &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="33,81" id="srcline81"> 81</a></span><span class="line">                    readIndex = readIndex + 192001;</span></span>
<span class="srcline"><span class="lineno"><a href="33,82" id="srcline82"> 82</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,83" id="srcline83"> 83</a></span><span class="line">                <span class="keyword">if</span> readIndex == 1</span></span>
<span class="srcline"><span class="lineno"><a href="33,84" id="srcline84"> 84</a></span><span class="line">                    y(i,:) = frac*obj.Buffer(192001) + (1-frac)*obj.Buffer(readIndex);</span></span>
<span class="srcline"><span class="lineno"><a href="33,85" id="srcline85"> 85</a></span><span class="line">                <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,86" id="srcline86"> 86</a></span><span class="line">                    y(i,:) = frac*obj.Buffer(readIndex - 1) + (1-frac)*obj.Buffer(readIndex);</span></span>
<span class="srcline"><span class="lineno"><a href="33,87" id="srcline87"> 87</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,88" id="srcline88"> 88</a></span><span class="line">                writeIndex = writeIndex + 1;</span></span>
<span class="srcline"><span class="lineno"><a href="33,89" id="srcline89"> 89</a></span><span class="line">                <span class="keyword">if</span> writeIndex &gt; 192001</span></span>
<span class="srcline"><span class="lineno"><a href="33,90" id="srcline90"> 90</a></span><span class="line">                    writeIndex =  1;</span></span>
<span class="srcline"><span class="lineno"><a href="33,91" id="srcline91"> 91</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,92" id="srcline92"> 92</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,93" id="srcline93"> 93</a></span><span class="line">            obj.BufferIndex = writeIndex;</span></span>
<span class="srcline"><span class="lineno"><a href="33,94" id="srcline94"> 94</a></span><span class="line">            out = y;</span></span>
<span class="srcline"><span class="lineno"><a href="33,95" id="srcline95"> 95</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,96" id="srcline96"> 96</a></span><span class="line">        <span class="keyword">function</span> reset(obj, fs)</span></span>
<span class="srcline"><span class="lineno"><a href="33,97" id="srcline97"> 97</a></span><span class="line">            obj.fs = fs;</span></span>
<span class="srcline"><span class="lineno"><a href="33,98" id="srcline98"> 98</a></span><span class="line">            obj.BufferIndex = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="33,99" id="srcline99"> 99</a></span><span class="line">            obj.Buffer = zeros(192001,2);</span></span>
<span class="srcline"><span class="lineno"><a href="33,100" id="srcline100">100</a></span><span class="line">            obj.phase = 0; </span></span>
<span class="srcline"><span class="lineno"><a href="33,101" id="srcline101">101</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,102" id="srcline102">102</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="33,103" id="srcline103">103</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,104" id="srcline104">104</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="33,105" id="srcline105">105</a></span><span class="line"> </span></span>
</pre>
</div>
